{{ define "main" }}

<link rel="stylesheet" href="https://unpkg.com/photoswipe@5/dist/photoswipe.css">
<script src="https://unpkg.com/photoswipe@5/dist/photoswipe-lightbox.esm.min.js" type="module"></script>

<link rel="stylesheet" href="/css/gallery-grid.css">
{{ partial "gallery-breadcrumbs.html" . }}
<article>

  <h1 class="page-header">{{ .Title }}</h1>

  {{ $parent := .Parent }}
  {{ $siblings := $parent.Pages.ByTitle }}
  {{ $currentIndex := 0 }}
  {{ $prev := "" }}
  {{ $next := "" }}
  {{ range $index, $page := $siblings }}
    {{ if eq $page.RelPermalink $.RelPermalink }}
      {{ $currentIndex = $index }}
      {{ if gt $index 0 }}
        {{ $prev = index $siblings (sub $index 1) }}
      {{ end }}
      {{ if lt $index (sub (len $siblings) 1) }}
        {{ $next = index $siblings (add $index 1) }}
      {{ end }}
    {{ end }}
  {{ end }}
  <div class="photo-nav-arrows">
    {{ if $prev }}
      <a class="photo-nav-arrow photo-nav-left" href="{{ $prev.RelPermalink }}" title="Previous photo" aria-label="Previous photo"></a>
    {{ end }}
    {{ if $next }}
      <a class="photo-nav-arrow photo-nav-right" href="{{ $next.RelPermalink }}" title="Next photo" aria-label="Next photo"></a>
    {{ end }}
  </div>
  {{ with .Resources.Match "*.jpg" }}
  {{ $img := index . 0 }}
  {{ $webp := $img.Process "webp" }}
  {{ $thumb := $webp.Fit "800x800" }}
  <div class="pswp-gallery">
    <a href="{{ $img.RelPermalink }}" data-pswp-width="{{ $img.Width }}" data-pswp-height="{{ $img.Height }}"
      data-pswp-src="{{ $img.RelPermalink }}" data-pswp-caption="{{ $.Title }}">
      <img src="{{ $thumb.RelPermalink }}" alt="{{ $.Title }}" style="max-width:100%;height:auto;cursor:zoom-in;" />
    </a>
  </div>
  <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"></div>
  <script type="module">
    import PhotoSwipeLightbox from 'https://unpkg.com/photoswipe@5/dist/photoswipe-lightbox.esm.min.js';
    const lightbox = new PhotoSwipeLightbox({
      gallery: '.pswp-gallery',
      children: 'a',
      pswpModule: () => import('https://unpkg.com/photoswipe@5/dist/photoswipe.esm.min.js'),
    });
    lightbox.init();
  </script>

  {{ if and $.Site.Params.ShowExifData ($img.Exif) }}
    {{ with $img.Exif }}
      {{ $hasExif := or (isset . "Model") (isset . "LensModel") (isset . "FocalLength") (isset . "Aperture") (isset . "ExposureTime") (isset . "ISO") (isset . "Date") }}
      {{ if $hasExif }}
        <section class="exif-data">
          <h2>Photo Details</h2>
          <ul>
            {{ if isset . "Model" }}<li><strong>Camera:</strong> {{ .Model }}</li>{{ end }}
            {{ if isset . "LensModel" }}<li><strong>Lens:</strong> {{ .LensModel }}</li>{{ end }}
            {{ if isset . "FocalLength" }}<li><strong>Focal Length:</strong> {{ .FocalLength }} mm</li>{{ end }}
            {{ if isset . "Aperture" }}<li><strong>Aperture:</strong> f/{{ .Aperture }}</li>{{ end }}
            {{ if isset . "ExposureTime" }}<li><strong>Exposure:</strong> {{ .ExposureTime }} s</li>{{ end }}
            {{ if isset . "ISO" }}<li><strong>ISO:</strong> {{ .ISO }}</li>{{ end }}
            {{ if isset . "Date" }}<li><strong>Date Taken:</strong> {{ .Date }}</li>{{ end }}
          </ul>
        </section>
      {{ end }}
    {{ end }}
  {{ end }}
  {{ else }}
  <div class="gallery-thumb gallery-thumb-placeholder">No image found</div>
  {{ end }}
  {{ with .Content }}
  <div class="photo-description">{{ . }}</div>
  {{ end }}
  
  {{ with .Params.buy_link }}
    <div class="buy-photo-btn-wrap">
      <a href="{{ . }}" target="_blank" rel="noopener" class="buy-photo-btn">Buy Print</a>
    </div>
  {{ end }}
  {{- if (and site.Params.ShowShareButtons (ne .Params.disableShare true)) }}
    {{- partial "share_icons.html" . -}}
  {{- end }}
  {{ end }}


